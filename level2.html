<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RightCode Game Level 2: Fruit Count</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Google Fonts (Kanit & Inter) -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Kanit:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <style>
        /* ‡πÉ‡∏ä‡πâ‡∏ü‡∏≠‡∏ô‡∏ï‡πå Kanit ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢ ‡πÅ‡∏•‡∏∞ Inter ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏© */
        body {
            font-family: 'Kanit', 'Inter', sans-serif;
        }

        /* ‡∏™‡πÑ‡∏ï‡∏•‡πå‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ö‡∏•‡πá‡∏≠‡∏Å‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ñ‡∏π‡∏Å‡∏•‡∏≤‡∏Å */
        .dragging {
            opacity: 0.5;
            transform: scale(0.95);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            cursor: grabbing;
        }

        /* ‡∏™‡πÑ‡∏ï‡∏•‡πå‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ä‡πà‡∏≠‡∏á‡∏ß‡∏≤‡∏á‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏°‡∏µ‡∏ö‡∏•‡πá‡∏≠‡∏Å‡∏•‡∏≤‡∏Å‡∏°‡∏≤‡∏ó‡∏±‡∏ö */
        .drag-over {
            border-style: dashed;
            border-color: #3b82f6; /* blue-500 */
            background-color: #eff6ff; /* blue-50 */
        }

        /* (‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á) ‡∏ã‡πà‡∏≠‡∏ô placeholder ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏°‡∏µ‡∏ú‡∏•‡πÑ‡∏°‡πâ‡∏ß‡∏≤‡∏á */
        .drop-zone:not(:empty) .drop-zone-placeholder {
            opacity: 0;
        }
        
        /* ‡∏™‡πÑ‡∏ï‡∏•‡πå‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ö‡∏•‡πá‡∏≠‡∏Å‡∏™‡∏±‡∏ï‡∏ß‡πå‡∏ó‡∏µ‡πà‡∏•‡∏≤‡∏Å‡πÑ‡∏î‡πâ */
        .drag-item {
            touch-action: none; /* ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏•‡∏≤‡∏Å‡∏ö‡∏ô‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠ */
            position: relative; 
            border: 4px solid transparent; 
        }
        
        /* ‡∏™‡πÑ‡∏ï‡∏•‡πå‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏£‡∏≠‡∏ö‡∏™‡∏µ‡πÅ‡∏î‡∏á/‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß */
        .border-correct {
            border-color: #22c55e; /* green-500 */
        }
        .border-wrong {
            border-color: #ef4444; /* red-500 */
        }

        /* ‡∏™‡πÑ‡∏ï‡∏•‡πå‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Modal Animation (Fade in & Zoom) */
        #success-modal {
            transition: opacity 0.3s ease-out;
        }
        #success-modal #modal-content {
            transition: all 0.3s ease-out 0.1s;
        }
        
        /* ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏ï‡∏≠‡∏ô‡∏ã‡πà‡∏≠‡∏ô (hidden) */
        #success-modal.hidden {
            opacity: 0;
            pointer-events: none;
        }
        #success-modal.hidden #modal-content {
            opacity: 0;
            transform: scale(0.9);
        }
        
        /* ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏ï‡∏≠‡∏ô‡πÅ‡∏™‡∏î‡∏á (‡πÑ‡∏°‡πà‡∏°‡∏µ .hidden) */
        #success-modal:not(.hidden) {
            opacity: 1;
        }
        #success-modal:not(.hidden) #modal-content {
            opacity: 1;
            transform: scale(1);
        }

    </style>
</head>
<body class="bg-gray-100 min-h-screen flex items-center justify-center p-4">

    <main class="w-full max-w-7xl bg-white rounded-2xl shadow-2xl p-6 md:p-10">
        
        <!-- Header -->
        <div class="text-center mb-8">
            <h1 class="text-3xl md:text-4xl font-bold text-green-600">RightCode Game Level 2</h1>
            <p class="text-lg md:text-xl text-gray-700 mt-2">‡∏ô‡∏±‡∏ö‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ú‡∏•‡πÑ‡∏°‡πâ</p>
            <p class="text-base text-gray-500 mt-4 max-w-2xl mx-auto">
                ‡∏•‡∏≤‡∏Å‡∏ö‡∏•‡πá‡∏≠‡∏Å‡∏ú‡∏•‡πÑ‡∏°‡πâ ‡πÑ‡∏õ‡∏ß‡∏≤‡∏á‡πÉ‡∏ô‡∏ä‡πà‡∏≠‡∏á‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç
                ‡πÉ‡∏´‡πâ <strong class="text-green-500">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ú‡∏•‡πÑ‡∏°‡πâ</strong> ‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö <strong class="text-blue-500">‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡πÉ‡∏ô‡∏ä‡πà‡∏≠‡∏á</strong>
            </p>
        </div>

        <!-- Drop Zones (10 ‡∏ä‡πà‡∏≠‡∏á) -->
        <div id="drop-zones-container" class="mb-8 p-4 bg-blue-50 rounded-xl border border-blue-200">
            <!-- (‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á) 10 ‡∏ä‡πà‡∏≠‡∏á: 5 ‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå (‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠) / 10 ‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå (Desktop) -->
            <div id="drop-zones" class="grid grid-cols-5 lg:grid-cols-10 gap-3">
                <!-- Drop zones 1-10 will be generated by JS -->
            </div>
        </div>

        <!-- Drag Items (Fruit Blocks) -->
        <div id="drag-items-bank" class="p-4 bg-green-50 rounded-xl border border-green-200 min-h-[150px]">
            <h3 class="text-center font-semibold text-gray-600 mb-4">‡∏ö‡∏•‡πá‡∏≠‡∏Å‡∏ú‡∏•‡πÑ‡∏°‡πâ (‡∏•‡∏≤‡∏Å‡∏à‡∏≤‡∏Å‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà)</h3>
            <div id="drag-items" class="flex flex-wrap justify-center items-start gap-3">
                <!-- Drag items 1-10 will be generated by JS -->
            </div>
        </div>

        <!-- Controls -->
        <div class="mt-8 text-center">
            <div class="flex justify-center gap-4">
                <button id="check-btn" class="px-8 py-3 bg-blue-600 text-white font-semibold rounded-lg shadow-md hover:bg-blue-700 transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed">
                    ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö
                </button>
                <button id="reset-btn" class="px-8 py-3 bg-gray-500 text-white font-semibold rounded-lg shadow-md hover:bg-gray-600 transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-gray-400 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed">
                    ‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÉ‡∏´‡∏°‡πà
                </button>
            </div>
            <div id="message" class="mt-6 text-2xl font-bold h-8">
                <!-- Messages (Success/Fail) -->
            </div>
        </div>

    </main>

    <!-- Success Modal -->
    <div id="success-modal" class="hidden fixed inset-0 bg-gray-900 bg-opacity-75 flex items-center justify-center p-4 z-50">
        <!-- Backdrop -->
        <div class="absolute inset-0" id="modal-backdrop"></div>
        
        <div id="modal-content" class="relative bg-white rounded-2xl shadow-xl p-8 max-w-md w-full text-center">
            <span class="text-8xl mb-6 block" role="img" aria-label="Party Popper">ü•≥</span>
            <h2 class="text-3xl font-bold text-gray-900 mb-2">‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏î‡πâ‡∏ß‡∏¢!</h2>
            <p class="text-lg text-gray-700 mb-8">‡∏Ñ‡∏∏‡∏ì‡πÄ‡∏Ñ‡∏•‡∏µ‡∏¢‡∏£‡πå‡∏î‡πà‡∏≤‡∏ô 2 ‡πÑ‡∏î‡πâ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!</p>
            <button id="play-again-btn" class="w-full px-8 py-4 bg-green-600 text-white font-semibold rounded-lg shadow-md hover:bg-green-700 transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-offset-2 text-lg">
                ‡πÄ‡∏•‡πà‡∏ô‡πÉ‡∏´‡∏°‡πà (Level 2)
            </button>
        </div>
    </div>
    
    <script>
        document.addEventListener('DOMContentLoaded', () => {

            // (‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á) ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏•‡πÑ‡∏°‡πâ (1-10)
            const itemsData = [
                { name: 'Apple', emoji: 'üçé', count: 1, th_name: '‡πÅ‡∏≠‡∏õ‡πÄ‡∏õ‡∏¥‡πâ‡∏•' },
                { name: 'Orange', emoji: 'üçä', count: 2, th_name: '‡∏™‡πâ‡∏°' },
                { name: 'Banana', emoji: 'üçå', count: 3, th_name: '‡∏Å‡∏•‡πâ‡∏ß‡∏¢' },
                { name: 'Strawberry', emoji: 'üçì', count: 4, th_name: '‡∏™‡∏ï‡∏£‡∏≠‡∏ß‡πå‡πÄ‡∏ö‡∏≠‡∏£‡πå‡∏£‡∏µ' },
                { name: 'Grapes', emoji: 'üçá', count: 5, th_name: '‡∏≠‡∏á‡∏∏‡πà‡∏ô' },
                { name: 'Watermelon', emoji: 'üçâ', count: 6, th_name: '‡πÅ‡∏ï‡∏á‡πÇ‡∏°' },
                { name: 'Pineapple', emoji: 'üçç', count: 7, th_name: '‡∏™‡∏±‡∏ö‡∏õ‡∏∞‡∏£‡∏î' },
                { name: 'Peach', emoji: 'üçë', count: 8, th_name: '‡∏û‡∏µ‡∏ä' },
                { name: 'Cherries', emoji: 'üçí', count: 9, th_name: '‡πÄ‡∏ä‡∏≠‡∏£‡πå‡∏£‡∏µ‡πà' },
                { name: 'Blueberry', emoji: 'ü´ê', count: 10, th_name: '‡∏ö‡∏•‡∏π‡πÄ‡∏ö‡∏≠‡∏£‡πå‡∏£‡∏µ' } // (‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á) ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏à‡∏≤‡∏Å Kiwi
            ];

            const dropZonesContainer = document.getElementById('drop-zones');
            const dragItemsContainer = document.getElementById('drag-items');
            const dragItemsBank = document.getElementById('drag-items-bank'); 
            const checkBtn = document.getElementById('check-btn');
            const resetBtn = document.getElementById('reset-btn');
            const messageEl = document.getElementById('message');

            const modal = document.getElementById('success-modal');
            const modalBackdrop = document.getElementById('modal-backdrop');
            const playAgainBtn = document.getElementById('play-again-btn');

            let draggedItem = null; 

            // --- ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡πÄ‡∏Å‡∏° ---
            function initGame() {
                modal.classList.add('hidden');
                dropZonesContainer.innerHTML = '';
                dragItemsContainer.innerHTML = '';
                messageEl.textContent = '';
                messageEl.className = 'mt-6 text-2xl font-bold h-8';
                
                checkBtn.disabled = false;
                resetBtn.disabled = false;

                // 1. ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ä‡πà‡∏≠‡∏á‡∏ß‡∏≤‡∏á (10 ‡∏ä‡πà‡∏≠‡∏á)
                for (let i = 1; i <= 10; i++) {
                    
                    // (‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á) 1. ‡∏™‡∏£‡πâ‡∏≤‡∏á Wrapper (‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç + ‡∏ä‡πà‡∏≠‡∏á)
                    const zoneWrapper = document.createElement('div');
                    zoneWrapper.className = 'flex flex-col items-center';

                    // (‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á) 2. ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç (‡πÑ‡∏ß‡πâ‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô)
                    const numberLabel = document.createElement('span');
                    numberLabel.className = 'text-2xl font-bold text-blue-600 mb-1'; // ‡∏™‡∏µ‡∏ô‡πâ‡∏≥‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏î‡πà‡∏ô‡∏ä‡∏±‡∏î
                    numberLabel.textContent = i;

                    // (‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á) 3. ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ä‡πà‡∏≠‡∏á‡∏ß‡∏≤‡∏á
                    const zone = document.createElement('div');
                    // (‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á) h-40 ‡πÅ‡∏•‡∏∞ w-full (‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡πÄ‡∏ï‡πá‡∏° wrapper)
                    zone.className = 'drop-zone h-40 w-full bg-white border-2 border-gray-300 rounded-lg flex flex-col items-center justify-center p-2 relative transition-all duration-150';
                    zone.dataset.index = i; 
                    
                    // (‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á) 4. ‡πÄ‡∏≠‡∏≤‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡∏•‡∏≤‡∏¢‡∏ô‡πâ‡∏≥‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å innerHTML
                    zone.innerHTML = `
                        <span class="feedback-icon absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 text-5xl font-bold opacity-0 transition-opacity duration-300 z-10 pointer-events-none"></span>
                        <span class="drop-zone-placeholder absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 text-gray-400 text-sm text-center transition-opacity duration-300">‡∏ß‡∏≤‡∏á‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà</span>
                    `;
                    
                    // (‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á) 5. ‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö‡∏£‡πà‡∏≤‡∏á
                    zoneWrapper.appendChild(numberLabel);
                    zoneWrapper.appendChild(zone);
                    addDropZoneListeners(zone); // ‡πÄ‡∏û‡∏¥‡πà‡∏° listener ‡πÉ‡∏´‡πâ‡∏Å‡∏±‡∏ö‡∏ä‡πà‡∏≠‡∏á zone
                    dropZonesContainer.appendChild(zoneWrapper); // ‡πÄ‡∏û‡∏¥‡πà‡∏° wrapper ‡∏•‡∏á‡πÉ‡∏ô container
                }

                // 2. ‡∏™‡∏∏‡πà‡∏°‡πÅ‡∏•‡∏∞‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ö‡∏•‡πá‡∏≠‡∏Å‡∏ú‡∏•‡πÑ‡∏°‡πâ
                const shuffledItems = [...itemsData].sort(() => Math.random() - 0.5);
                
                shuffledItems.forEach(item => {
                    const element = document.createElement('div');
                    element.id = `item-${item.name}`;
                    // (‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á) h-40 w-28 (‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏π‡∏á)
                    element.className = 'drag-item h-40 w-28 bg-white shadow-md rounded-lg flex flex-col items-center justify-between cursor-move transition-all duration-150 p-2 border-4 border-transparent hover:shadow-lg';
                    element.draggable = true;
                    element.dataset.item = item.name; 
                    element.dataset.count = item.count; // (‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç) ‡πÄ‡∏Å‡πá‡∏ö‡∏à‡∏≥‡∏ô‡∏ß‡∏ô
                    
                    // (‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á) ‡∏™‡∏£‡πâ‡∏≤‡∏á container ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ú‡∏•‡πÑ‡∏°‡πâ (h-28)
                    let emojiContainer = '<div class="flex flex-wrap justify-center items-center gap-1 p-1 overflow-hidden h-28">';
                    let emojiSize = 'text-3xl'; // ‡∏Ç‡∏ô‡∏≤‡∏î‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô
                    
                    // (‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á) Logic ‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡πÅ‡∏ñ‡∏ß‡∏•‡∏∞ 5
                    if (item.count > 3) emojiSize = 'text-2xl';
                    if (item.count > 5) {
                        // ‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡∏ß‡πâ‡∏≤‡∏á‡πÉ‡∏´‡πâ‡∏û‡∏≠‡∏î‡∏µ 5 ‡∏•‡∏π‡∏Å
                        emojiContainer = '<div class="flex flex-wrap justify-center items-center gap-1 p-1 overflow-hidden h-28" style="width: 100px;">';
                        emojiSize = 'text-xl'; 
                    }
                    if (item.count > 8) {
                         emojiSize = 'text-lg'; // ‡πÄ‡∏•‡πá‡∏Å‡∏™‡∏∏‡∏î‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö 9, 10
                    }

                    for (let j = 0; j < item.count; j++) {
                        emojiContainer += `<span class="${emojiSize}" role="img" aria-label="${item.th_name}">${item.emoji}</span>`;
                    }
                    emojiContainer += '</div>';

                    element.innerHTML = emojiContainer + `
                        <span class="font-medium text-sm text-gray-800 mt-1">${item.th_name}</span>
                    `;

                    addDragItemListeners(element);
                    dragItemsContainer.appendChild(element);
                });
            }

            // --- Event Listeners (Drag Items) ---
            function addDragItemListeners(item) {
                item.addEventListener('dragstart', handleDragStart);
                item.addEventListener('dragend', handleDragEnd);
                item.addEventListener('touchstart', handleTouchStart, { passive: false });
                item.addEventListener('touchmove', handleTouchMove, { passive: false });
                item.addEventListener('touchend', handleTouchEnd);
            }

            // --- Event Listeners (Drop Zones) ---
            function addDropZoneListeners(zone) {
                zone.addEventListener('dragover', handleDragOver);
                zone.addEventListener('dragenter', handleDragEnter);
                zone.addEventListener('dragleave', handleDragLeave);
                zone.addEventListener('drop', handleDrop);
            }
            
            addDropZoneListeners(dragItemsBank); // ‡∏•‡∏≤‡∏Å‡∏Å‡∏•‡∏±‡∏ö Bank

            // --- Handlers: ‡∏Å‡∏≤‡∏£‡∏•‡∏≤‡∏Å (Mouse) ---
            
            function handleDragStart(e) {
                draggedItem = this;
                this.classList.add('dragging');
                e.dataTransfer.effectAllowed = 'move';
                e.dataTransfer.setData('text/plain', this.id);
                setTimeout(() => this.style.visibility = 'hidden', 0);
            }

            function handleDragEnd() {
                this.classList.remove('dragging');
                this.style.visibility = 'visible';
                draggedItem = null;
                document.querySelectorAll('.drag-over').forEach(zone => zone.classList.remove('drag-over'));
            }

            function handleDragOver(e) {
                e.preventDefault(); 
                e.dataTransfer.dropEffect = 'move';
            }

            function handleDragEnter(e) {
                e.preventDefault();
                // (‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á) ‡∏ï‡πâ‡∏≠‡∏á‡∏´‡∏≤ .drop-zone ‡∏´‡∏£‡∏∑‡∏≠ #drag-items-bank
                const dropTarget = e.target.closest('.drop-zone, #drag-items-bank');
                if (dropTarget) dropTarget.classList.add('drag-over');
            }

            function handleDragLeave(e) {
                const dropTarget = e.target.closest('.drop-zone, #drag-items-bank');
                if (dropTarget) dropTarget.classList.remove('drag-over');
            }

            function handleDrop(e) {
                e.preventDefault();
                e.stopPropagation(); 
                
                // (‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á) ‡∏ï‡πâ‡∏≠‡∏á‡∏´‡∏≤ .drop-zone ‡∏´‡∏£‡∏∑‡∏≠ #drag-items-bank
                const dropTarget = e.target.closest('.drop-zone, #drag-items-bank');
                if (!dropTarget || !draggedItem) return;

                dropTarget.classList.remove('drag-over');
                draggedItem.classList.remove('border-correct', 'border-wrong');

                if (dropTarget.id === 'drag-items-bank') {
                    dragItemsContainer.appendChild(draggedItem);
                    return; 
                }

                const existingItem = dropTarget.querySelector('.drag-item');
                if (existingItem) {
                    existingItem.classList.remove('border-correct', 'border-wrong');
                    dragItemsContainer.appendChild(existingItem);
                }
                
                dropTarget.appendChild(draggedItem);

                // (‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á) ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á (Matching)
                const droppedItemCount = parseInt(draggedItem.dataset.count, 10);
                const slotIndex = parseInt(dropTarget.dataset.index, 10);

                if (droppedItemCount === slotIndex) {
                    draggedItem.classList.add('border-correct');
                } else {
                    draggedItem.classList.add('border-wrong');
                }
            }

            // --- Handlers: ‡∏Å‡∏≤‡∏£‡∏•‡∏≤‡∏Å (Touch) ---
            let touchStartX, touchStartY, currentDropTarget = null, clone = null;

            function handleTouchStart(e) {
                e.preventDefault();
                draggedItem = this;
                draggedItem.classList.add('dragging');
                const touch = e.touches[0];
                touchStartX = touch.clientX;
                touchStartY = touch.clientY;

                clone = draggedItem.cloneNode(true);
                clone.style.position = 'absolute';
                clone.style.pointerEvents = 'none';
                clone.style.zIndex = '1000';
                clone.style.opacity = '0.8';
                document.body.appendChild(clone);
                
                draggedItem.style.visibility = 'hidden';
                moveClone(touch.pageX, touch.pageY);
            }
            
            function moveClone(x, y) {
                if (!clone) return;
                clone.style.left = `${x - clone.offsetWidth / 2}px`;
                clone.style.top = `${y - clone.offsetHeight / 2}px`;
            }

            function handleTouchMove(e) {
                e.preventDefault();
                if (!draggedItem) return;
                const touch = e.touches[0];
                moveClone(touch.pageX, touch.pageY);

                clone.style.display = 'none'; 
                let elementUnder = document.elementFromPoint(touch.clientX, touch.clientY);
                clone.style.display = 'flex'; 

                // (‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á) ‡∏ï‡πâ‡∏≠‡∏á‡∏´‡∏≤ .drop-zone ‡∏´‡∏£‡∏∑‡∏≠ #drag-items-bank
                const dropTarget = elementUnder ? elementUnder.closest('.drop-zone, #drag-items-bank') : null;

                if (currentDropTarget && currentDropTarget !== dropTarget) {
                    currentDropTarget.classList.remove('drag-over');
                }
                
                if (dropTarget) {
                    dropTarget.classList.add('drag-over');
                    currentDropTarget = dropTarget;
                } else {
                    currentDropTarget = null;
                }
            }

            function handleTouchEnd(e) {
                e.preventDefault();
                if (!draggedItem) return;

                if (clone) clone.remove();
                clone = null;
                draggedItem.style.visibility = 'visible';
                draggedItem.classList.remove('dragging');

                if (currentDropTarget) {
                    currentDropTarget.classList.remove('drag-over');
                    handleDrop({ 
                        target: currentDropTarget, 
                        preventDefault: () => {}, 
                        stopPropagation: () => {} 
                    });
                } else {
                    draggedItem.classList.remove('border-correct', 'border-wrong');
                    dragItemsContainer.appendChild(draggedItem);
                }
                draggedItem = null;
                currentDropTarget = null;
            }

            // --- ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÅ‡∏•‡∏∞‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï ---
            
            async function checkOrder() {
                checkBtn.disabled = true;
                resetBtn.disabled = true;
                messageEl.textContent = '';
                
                // (‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á) ‡∏ï‡πâ‡∏≠‡∏á‡∏´‡∏≤ .feedback-icon ‡∏†‡∏≤‡∏¢‡πÉ‡∏ô .drop-zone
                document.querySelectorAll('.drop-zone .feedback-icon').forEach(icon => {
                    icon.style.opacity = '0';
                    icon.textContent = '';
                });
                document.querySelectorAll('.drag-item').forEach(item => {
                    item.classList.remove('border-correct', 'border-wrong');
                });
                
                await new Promise(resolve => setTimeout(resolve, 100)); 

                // (‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á) ‡∏ï‡πâ‡∏≠‡∏á‡∏´‡∏≤ .drop-zone ‡∏†‡∏≤‡∏¢‡πÉ‡∏ô wrapper
                const zones = dropZonesContainer.querySelectorAll('.drop-zone');
                let allCorrect = true;

                for (let i = 0; i < zones.length; i++) {
                    const zone = zones[i];
                    const item = zone.querySelector('.drag-item');
                    const icon = zone.querySelector('.feedback-icon');
                    
                    // (‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á) ‡∏ï‡∏£‡∏£‡∏Å‡∏∞‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö (Matching)
                    const slotIndex = parseInt(zone.dataset.index, 10);
                    let isCorrect = false;
                    if (item) {
                        const itemCount = parseInt(item.dataset.count, 10);
                        isCorrect = (itemCount === slotIndex);
                    }
                    
                    icon.classList.remove('text-green-600', 'text-red-600');

                    if (isCorrect) {
                        icon.textContent = '‚úì';
                        icon.classList.add('text-green-600');
                        item?.classList.add('border-correct');
                    } else {
                        icon.textContent = '‚úó';
                        icon.classList.add('text-red-600');
                        item?.classList.add('border-wrong');
                        allCorrect = false; 
                    }

                    icon.style.opacity = '1';
                    await new Promise(resolve => setTimeout(resolve, 200)); // ‡πÄ‡∏£‡πá‡∏ß‡∏Ç‡∏∂‡πâ‡∏ô‡πÄ‡∏•‡πá‡∏Å‡∏ô‡πâ‡∏≠‡∏¢
                }

                if (allCorrect) {
                    modal.classList.remove('hidden');
                    checkBtn.disabled = true;
                    resetBtn.disabled = false;
                } else {
                    messageEl.textContent = '‡πÇ‡∏≠‡πä‡∏∞! ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á ‡∏•‡∏≠‡∏á‡∏û‡∏¢‡∏≤‡∏¢‡∏≤‡∏°‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ô‡∏∞ üò¢';
                    messageEl.className = 'mt-6 text-2xl font-bold h-8 text-red-600';
                    checkBtn.disabled = false;
                    resetBtn.disabled = false;
                }
            }

            // --- ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏õ‡∏∏‡πà‡∏° ---
            checkBtn.addEventListener('click', checkOrder);
            resetBtn.addEventListener('click', initGame);
            playAgainBtn.addEventListener('click', initGame);
            modalBackdrop.addEventListener('click', initGame);

            // --- ‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏Å‡∏°‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÅ‡∏£‡∏Å ---
            initGame();
        });
    </script>

</body>
</html>

